<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pulsecore</title>
    <link rel="stylesheet" href="public/style.css">
</head>
<body>
    <button id="menuToggle">Menu</button>
    <div id="slideMenu">
    <div id="controls">
        <div id="stateLabel">State: Pre-Pulse</div>
        <div id="genesisRow" class="controlRow">
            <label for="genesisModeSelect">Genesis Mode:</label>
            <select id="genesisModeSelect">
                <option value="stable">Stable</option>
                <option value="chaotic">Chaotic</option>
                <option value="organic">Organic</option>
                <option value="fractal">Fractal</option>
                <option value="seeded">Seeded</option>
            </select>
        </div>
        <div id="genesisPhaseRow" class="controlRow">
            <label>Genesis Phase:</label>
            <input type="checkbox" id="postPhaseToggle">
            <label for="postPhaseToggle">Post-Pulse ‚ö°</label>
        </div>
        <div id="controlButtons" class="controlRow">
            <button id="startBtn">Start</button>
            <button id="stopBtn" disabled>Stop</button>
            <button id="clearBtn">Clear</button>
            <button id="randomizeBtn">Randomize</button>
        </div>
        <div id="pulseRow" class="controlRow">
            <div id="pulseCounterDisplay">Frame: <span id="pulseCounter">0</span></div>
            <button id="reverseBtn">Reverse</button>
        </div>
        <label>Frame Rate: <input type="range" id="frameRateSlider" min="50" max="1000" step="50" value="500"></label>
        <label>Collapse Threshold (Pulse Units): <input type="number" id="collapseThreshold" value="1" step="0.001"></label>
        <label>Zoom: <input type="range" id="zoomSlider" min="1" max="50" step="1" value="10" title="Adjust pixel size. Finer detail may require a higher resolution limit."></label>
        <label>Resolution Limit: <input type="range" id="resolutionSlider" min="250" max="2000" step="50" value="500"><span id="resolutionWarning" class="warning" style="display:none;margin-left:4px;">‚ö†Ô∏è High resolution may impact performance</span></label>
        <label>Fold Threshold:
            <span id="foldValue">2</span>
            <input type="range" id="foldSlider" min="0" max="10" step="1" value="2">
        </label>
        <label>Neighbor Count:
            <span id="neighborValue">2</span>
            <input type="range" id="neighborSlider" min="0" max="8" step="1" value="2">
        </label>
        <label id="pulseLengthLabel">Pulse Length: <input type="number" id="pulseLength" value="3" min="1" /></label>
        <label><input type="checkbox" id="debugOverlay"> Field Tension Mapping</label>
        <select id="fieldTensionMode" style="margin-top:4px">
            <option value="none" selected>None</option>
            <option value="pulse-barrier">Pulse Barrier Test 31</option>
            <option value="waveguide">Waveguide Lock A</option>
            <option value="channel-field">Symmetric Channel Field</option>
            <option value="containment">Containment Corridor 1</option>
            <option value="reactor-chamber">Dual Reactor Chamber</option>
        </select>
        <label><input type="checkbox" id="pulseFlash"> Pulse Flash</label>
        <label><input type="checkbox" id="gridLinesToggle" checked> Grid Lines</label>
        <label><input type="checkbox" id="centerViewToggle"> Center View</label>
        <div>Frame Duration: <span id="frameDuration">0</span>ms</div>
        <div>Complexity: <span id="frameComplexity">0</span></div>
        <div>Pulse Energy: <span id="pulseEnergy">0</span></div>
        <div id="tensionDisplay">Tension: <span id="tensionValue">0</span></div>
    </div>

    <div id="tools">
        <label>Tool:
            <select id="toolSelect">
                <option value="brush">Brush</option>
                <option value="pulse">Pulse Injector</option>
                <option value="stamper">Pattern Stamper</option>
            </select>
        </label>
        <label>Color: <input type="color" id="colorPicker" value="#ff6ec7"></label>
        <label id="patternLabel">Pattern:
            <select id="patternSelect"></select>
        </label>
    </div>

    <div id="patternSaver">
        <input type="text" id="patternName" placeholder="Pattern Name">
        <button onclick="saveCurrentPattern()">üíæ Save Pattern</button>
        <input type="file" id="patternLoader" accept=".json" onchange="handlePatternSelection(this)">
        <button id="patternUploadBtn" onclick="uploadPattern()" style="display:none">Upload Pattern</button>
    </div>

    <div id="infoLinks" class="controlRow">
        <a href="#" id="aboutLink">About</a>
        <span>|</span>
        <a href="#" id="directionsLink">Directions</a>
    </div>

    </div>

    <div id="aboutPopup" class="popupOverlay infoSection">
        <button class="closePopup">X</button>
        <h2>About Pulse-Core</h2>
        <p>Pulse-Core is a browser-based sandbox for experimenting with a simple pulse simulation. Cells flip on and off based on neighbor counts and optional folding logic. Draw patterns, inject pulses and watch the results in real time.</p>
        <ul>
            <li>Dynamic grid adapts with the zoom slider (capped at 500√ó500 cells).</li>
            <li>Start/Stop controls with reverse stepping.</li>
            <li>Adjust pulse length, folding threshold and neighbor count while running.</li>
            <li>Brush, pulse injector and pattern stamper tools. Right-click any cell to erase.</li>
            <li>Color picker and optional flash effect.</li>
            <li>Save patterns as JSON and reload them later.</li>
            <li>Toggle debug numbers and grid lines.</li>
        </ul>
    </div>

    <div id="directionsPopup" class="popupOverlay infoSection">
        <button class="closePopup">X</button>
        <h2>How to Use</h2>
        <ol>
            <li>Open <code>index.html</code> in your browser.</li>
            <li>Select a tool from the <strong>Tool</strong> dropdown and draw on the grid. Right-click to erase cells.</li>
            <li>Press <strong>Start</strong> to animate the pattern and tweak the sliders as it runs.</li>
            <li>Use <strong>Save Pattern</strong> to download your design or <strong>Upload Pattern</strong> to load a saved file.</li>
            <li>The <strong>Reverse</strong> button steps backward through previous pulses.</li>
        </ol>
    <p>Once loaded, the tool works entirely offline.</p>
    </div>

    <canvas id="grid"></canvas>
    <div id="novaOverlay">Data Nova</div>
    <div id="novaInfoContainer"></div>

    <script type="module">
        import { init } from './public/app.js';
        init();
    </script>
</body>
</html>
