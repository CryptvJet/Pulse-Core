<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pulsecore</title>
    <link rel="stylesheet" href="public/style.css">
</head>
<body>
    <div id="liveCounters">
        <div>Frame Duration: <span id="frameDuration">0</span>ms</div>
        <div>Complexity: <span id="frameComplexity">0</span></div>
        <div>Pulse Energy: <span id="pulseEnergy">0</span></div>
        <div id="tensionDisplay">Tension: <span id="tensionValue">0</span></div>
        <div>Frame: <span id="pulseCounterTop">0</span></div>
    </div>
    <button id="menuToggle">Menu</button>
    <div id="slideMenu">
    <div id="controls">
        <div class="section">
        <h4 class="sectionHeader">üß™ Simulation State</h4>
        <div class="sectionContent">
        <div id="stateLabel">State: Pre-Pulse</div>
        <div id="genesisRow" class="controlRow">
            <label for="genesisModeSelect">Genesis Mode:</label>
            <select id="genesisModeSelect">
                <option value="stable">Stable</option>
                <option value="chaotic">Chaotic</option>
                <option value="organic">Organic</option>
                <option value="fractal">Fractal</option>
                <option value="seeded">Seeded</option>
            </select>
        </div>
        <div id="genesisPhaseRow" class="controlRow">
            <label>Genesis Phase:</label>
            <input type="checkbox" id="postPhaseToggle">
            <label for="postPhaseToggle">Post-Pulse ‚ö°</label>
        </div>
        <div id="controlButtons" class="controlRow">
            <button id="startBtn">Start</button>
            <button id="stopBtn" disabled>Stop</button>
            <button id="clearBtn">Clear</button>
            <button id="randomizeBtn">Randomize</button>
        </div>
        <div id="pulseRow" class="controlRow">
            <div id="pulseCounterDisplay">Frame: <span id="pulseCounter">0</span></div>
            <button id="reverseBtn">Reverse</button>
        </div>
        <label>Frame Rate: <input type="range" id="frameRateSlider" min="50" max="1000" step="50" value="500"></label>
        </div>
        </div>
        <div class="section">
        <h4 class="sectionHeader">üîß Logic Settings</h4>
        <div class="sectionContent">
        <label>Collapse Threshold (Pulse Units) <span title="Total pulse energy that collapses the grid.">‚ÑπÔ∏è</span>: <input type="number" id="collapseThreshold" value="1" step="0.001"></label>
        <label>Fold Threshold <span title="Number of flickers needed to trigger a collapse.">‚ÑπÔ∏è</span>:
            <span id="foldValue">2</span>
            <input type="range" id="foldSlider" min="0" max="10" step="1" value="2">
        </label>
        <label>Neighbor Count:
            <span id="neighborValue">2</span>
            <input type="range" id="neighborSlider" min="0" max="8" step="1" value="2">
        </label>
        <label>Potential Threshold: <input type="number" id="potentialThreshold" min="0" max="1" step="0.05" value="0.5"></label>
        <label>Potential Decay <span title="How quickly pulse energy dissipates in inactive cells.">‚ÑπÔ∏è</span>: <input type="number" id="potentialDecay" min="0.90" max="0.99" step="0.01" value="0.95"></label>
        <label id="pulseLengthLabel">Pulse Length <span title="Number of frames a cell stays active after flipping.">‚ÑπÔ∏è</span>: <input type="number" id="pulseLength" value="3" min="1" /></label>
        </div>
        </div>
        <div class="section">
        <h4 class="sectionHeader">üé® Display & Audio</h4>
        <div class="sectionContent">
        <label>Zoom: <input type="range" id="zoomSlider" min="1" max="50" step="1" value="10" title="Adjust pixel size. Finer detail may require a higher resolution limit."></label>
        <label>Resolution Limit: <input type="range" id="resolutionSlider" min="250" max="2000" step="50" value="500"><span id="resolutionWarning" class="warning" style="display:none;margin-left:4px;">‚ö†Ô∏è High resolution may impact performance</span></label>
        <label><input type="checkbox" id="debugOverlay"> Field Tension Mapping</label>
        <select id="fieldTensionMode" style="margin-top:4px">
            <option value="none" selected>None</option>
            <option value="pulse-barrier">Pulse Barrier Test 31</option>
            <option value="waveguide">Waveguide Lock A</option>
            <option value="channel-field">Symmetric Channel Field</option>
            <option value="containment">Containment Corridor 1</option>
            <option value="reactor-chamber">Dual Reactor Chamber</option>
        </select>
        <label><input type="checkbox" id="phaseColorToggle"> Phase Colors</label>
        <div id="phaseModeControls" style="margin-top: 5px;">
            <label for="phaseMode">Phase Mode:</label>
            <select id="phaseMode">
                <option value="color">Color</option>
                <option value="grayscale">Grayscale</option>
            </select>
        </div>
        <label><input type="checkbox" id="soundToggle"> Enable Sound</label>
        <label><input type="checkbox" id="gridLinesToggle" checked> Grid Lines</label>
        <label><input type="checkbox" id="centerViewToggle"> Center View</label>
        </div>
        </div>
    </div>

    <div class="section">
    <h4 class="sectionHeader">üíæ Pattern Tools</h4>
    <div class="sectionContent">
    <div id="tools">
        <label>Tool:
            <select id="toolSelect">
                <option value="brush">Brush</option>
                <option value="pulse">Pulse Injector</option>
                <option value="stamper">Pattern Stamper</option>
            </select>
        </label>
        <label>Color: <input type="color" id="colorPicker" value="#ff009d"></label>
        <label id="patternLabel">Pattern:
            <select id="patternSelect"></select>
        </label>
    </div>

    <div id="patternSaver">
        <input type="text" id="patternName" placeholder="Pattern Name">
        <button id="patternSaverButton">üíæ Save Pattern</button>
        <input type="file" id="patternLoader" accept=".json">
        <button id="patternUploadBtn" style="display:none">Upload Pattern</button>
    </div>

    </div>
    </div>
    <div id="infoLinks" class="controlRow">
        <a href="#" id="aboutLink">About</a>
        <span>|</span>
        <a href="#" id="directionsLink">Directions</a>
        <span>|</span>
        <a href="#" id="algosLink">Algos</a>
    </div>
    <div id="hardResetRow" class="controlRow">
        <button id="hardResetBtn">Hard Reset</button>
    </div>
    </div>

    <div id="aboutPopup" class="popupOverlay infoSection">
        <button class="closePopup">X</button>
        <h2>About Pulse-Core</h2>
        <p>Pulse-Core is a browser-based sandbox for experimenting with a simple pulse simulation. Cells flip on and off based on neighbor counts and optional folding logic. Draw patterns, inject pulses and watch the results in real time.</p>
        <ul>
            <li>Dynamic grid adapts with the zoom slider. The Resolution Limit slider caps the grid between 250 and 2000 cells per side.</li>
            <li>Start/Stop controls with reverse stepping.</li>
            <li>Adjust pulse length, folding threshold and neighbor count while running.</li>
            <li>Brush, pulse injector and pattern stamper tools. Right-click any cell to erase.</li>
            <li>Color picker for customizing cells.</li>
            <li>Save patterns as JSON and reload them later.</li>
            <li>Toggle debug numbers and grid lines.</li>
        </ul>
    </div>

    <div id="directionsPopup" class="popupOverlay infoSection">
        <button class="closePopup">X</button>
        <h2>How to Use</h2>
        <ol>
            <li>Open <code>index.html</code> in your browser.</li>
            <li>Select a tool from the <strong>Tool</strong> dropdown and draw on the grid. Right-click to erase cells.</li>
            <li>Press <strong>Start</strong> to animate the pattern and tweak the sliders as it runs.</li>
            <li>Use <strong>Save Pattern</strong> to download your design or <strong>Upload Pattern</strong> to load a saved file.</li>
            <li>The <strong>Reverse</strong> button steps backward through previous pulses.</li>
        </ol>
    <p>Once loaded, the tool works entirely offline.</p>
    </div>

    <div id="algosPopup" class="popupOverlay infoSection">
        <button class="closePopup">X</button>
        <h2>Algos</h2>
        <p>Pulse-Core relies on a few simple rules that echo Binary Pulse Theory. Cells flip between 0 and 1 as pulses move across the grid.</p>
        <h3>Simulation Basics</h3>
        <ul>
            <li><strong>Pulse Propagation</strong> ‚Äì Cells change state based on neighbors and built up potential.</li>
            <li><strong>Neighbor Count</strong> ‚Äì Active neighbors push a cell past its threshold.</li>
            <li><strong>Fold Threshold</strong> ‚Äì Large clusters collapse into new forms.</li>
            <li><strong>Pulse Length</strong> ‚Äì Sets how long a pulse lasts before fading.</li>
            <li><strong>Potential &amp; Decay</strong> ‚Äì Potential rises and falls over time; crossing the limit may flip a cell.</li>
            <li><strong>Collapse Events</strong> ‚Äì When energy climbs too high the field wipes and restarts.</li>
        </ul>
        <h3>Binary Pulse Theory</h3>
        <ul>
            <li>Each cell is a tiny pulse flickering between 0 and 1.</li>
            <li>Stable shapes mimic molecules while unstable ones create turbulence.</li>
            <li>Waves, shells and explosions all arise from these simple steps.</li>
        </ul>
        <p>This popout shows how basic logic can build complex patterns.</p>
    </div>

    <canvas id="grid"></canvas>
    <div id="novaOverlay">Data Nova</div>
    <!-- Required container for nova information popups -->
    <div id="novaInfoContainer"></div>

    <script type="module">
        import { init } from './public/app.js';
        init();
    </script>
</body>
</html>
